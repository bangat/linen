<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta property="og:title" content="린넨실" />
  <meta property="og:description" content="일일 사용량에 맞게 요청 바랍니다:D" />
  <meta property="og:image" content="https://i.ibb.co/TKrjqyL/001-3.png" />
  <meta property="og:url" content="https://hallymlinen.netlify.app/" />
  <meta property="og:type" content="website" />
  <title>린넨실 요청서</title>

  <link rel="stylesheet" href="linen.css" />

  <!-- 아이콘/파비콘 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />

  <!-- 알림음 -->
  <audio
    id="notificationSound"
    src="https://drive.google.com/uc?export=download&id=1OwurEapLxRtn2I079OEjdkKxFncB35Ao"
  ></audio>
</head>
<body>
  <!-- 헤더 -->
  <div class="content">
    <div class="header-container">
      <h1 id="noticeHeader">요청서</h1>
    </div>
  </div>

  <!-- 폼 -->
  <form id="linenRequestForm">
    <!-- 병동 + 날짜 (항상 2열 한 줄) -->
    <div class="form-grid form-grid--two">
      <div class="form-group">
        <select id="wardDropdown" name="ward" required>
          <option value="" disabled selected>병동을 선택해주세요.</option>
          <option value="낮병동">낮병동</option>
          <option value="심혈관">심혈관</option>
          <option value="내시경실">내시경실</option>
          <option value="중환자실">중환자실</option>
          <option value="인공신장실">인공신장실</option>
          <option value="수술실">수술실</option>
          <option value="면역치료실">면역치료실</option>
          <option value="응급실">응급실</option>
          <option value="방사선종양학과">방사선종양학과</option>
        </select>
      </div>

      <div class="form-group date-wrapper">
        <label for="requestDate" class="date-placeholder">입고 요청일을 선택해주세요.</label>
        <input type="date" id="requestDate" class="date-picker" name="requestDate" required />
      </div>
    </div>

    <!-- 공지 마퀴 (새로고침 버튼 제거, 호버 멈춤 금지) -->
    <div class="notice-bar" id="noticeBar" aria-live="polite">
      <div class="notice-label">공지</div>
      <div class="notice-track" id="noticeTrack">불러오는 중...</div>
    </div>

    <!-- 탭 -->
    <div class="tabs">
      <div class="tab active" data-tab="sheet">시트/기타</div>
      <div class="tab" data-tab="normal">일반 환의</div>
      <div class="tab" data-tab="ortho">정형 환의</div>
      <div class="tab" data-tab="uniform">근 무 복</div>
      <div class="tab" data-tab="inventory">재고/요청</div>
    </div>

    <!-- 섹션 -->
    <div id="sheet" class="form-section active">
      <table>
        <tr><th>품목</th><th>요청수량</th></tr>
      </table>
    </div>

    <div id="normal" class="form-section">
      <table>
        <tr><th>품목</th><th>요청수량</th></tr>
      </table>
    </div>

    <div id="ortho" class="form-section">
      <table>
        <tr><th>품목</th><th>요청수량</th></tr>
      </table>
    </div>

    <div id="uniform" class="form-section">
      <table>
        <tr><th>품목</th><th>요청수량</th></tr>
      </table>
    </div>

    <div id="inventory" class="form-section">
      <div class="camera-section">
        <div class="button-container">
          <button type="button" id="cameraButton">
            <i class="fa fa-camera camera-icon"></i> 재고사진
          </button>
          <input type="file" id="inventoryPhoto" style="display:none" accept="image/*" />
        </div>
        <button type="submit" id="submitBtn">
          <i class="fas fa-paper-plane submit-icon"></i> 요청하기
        </button>
        <img id="preview" src="#" alt="Preview" style="max-width:100%; display:none"/>
      </div>
    </div>

    <div id="statusMessage">요청을 전송중 입니다..잠시만 기다려주세요..</div>
  </form>

  <div id="responseMessage"></div>

  <button id="adminAccessBtn" style="display:none;">관리자 접속</button>

  <!-- 스크립트 -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="js.js"></script>

  <!-- 인라인: 표 생성/탭/라벨만 -->
  <script>
    $(function(){
      /* 표 자동 생성 */
      const sheetItems = [
        { name: "대 시 트", key: "대시트_요청수량" },
        { name: "반 시 트", key: "반시트_요청수량" },
        { name: "베 갯 잇", key: "베갯잇_요청수량" },
        { name: "중 환 의", key: "중환의_요청수량" },
        { name: "이 불", key: "이불_요청수량" },
        { name: "얼음주머니", key: "얼음포_요청수량" },
        { name: "억 제 대", key: "억제대_요청수량" },
        { name: "수 건", key: "수건_요청수량" },
        { name: "검진복(하의)", key: "하의_요청수량" },
      ];
      const requiredSizes = ["3XL", "2XL", "XL", "L"];
      const sizes = ["4XL", "3XL", "2XL", "XL", "L", "M", "S"];
      const types = ["상의", "하의"];

      function populateTable(id, items) {
        const table = document.querySelector(`#${id} table`);
        items.forEach(item => {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${item.name}</td><td><input type="number" name="${item.key}" min="0"/></td>`;
          table.appendChild(tr);
        });
      }
      const gen = (sizes, types) => sizes.flatMap(s => types.map(t => ({name:`${s} ${t}`, key:`${s}_${t}_요청수량`})));

      populateTable("sheet", sheetItems);
      populateTable("normal", gen(sizes, types));
      populateTable("ortho", gen(sizes.slice(1), types));
      populateTable("uniform", gen(requiredSizes, types));

      /* 탭 */
      $("[data-tab='normal'], [data-tab='ortho'], [data-tab='uniform']").addClass("disabled");
      $(".tab").on("click", function(){
        if ($(this).hasClass("disabled")) return;
        const tabId = $(this).data("tab");
        $(".tab").removeClass("active").css("background-color", "");
        $(this).addClass("active").css("background-color", "#4CAF50");
        $(".form-section").removeClass("active");
        $("#"+tabId).addClass("active");
      });

      /* 날짜 라벨 show/hide */
      const $date = $("#requestDate"), $label = $(".date-placeholder");
      const sync = () => $label.toggle(!$date.val());
      $label.on("click", () => $date.trigger("focus"));
      $date.on("input change blur", sync); sync();

      /* 헤더 클릭 시: 수량만 초기화, 병동/날짜는 js.js가 복구 */
      $("#noticeHeader").on("click.reset", function(){
        $('input[type="number"]').val('');
        // 탭 시트로
        $(".tab").removeClass("active").css("background-color", "");
        $(".form-section").removeClass("active");
        $('[data-tab="sheet"]').addClass("active").css("background-color", "#4CAF50");
        $("#sheet").addClass("active");
        // 날짜 라벨 동기화
        sync();
      });
    });
  </script>
</body>
</html>
